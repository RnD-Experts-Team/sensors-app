import{r as o,j as t,c as I,H as je}from"./app-CcQem-as.js";import{c as ae,S as ve,A as ge}from"./app-layout-DquRM7Xy.js";import{R as Ne,C as M,a as oe,d as R,b as be,c as ke,B as ce}from"./badge-GIPNTP_w.js";import{a as L,B as N}from"./app-logo-icon-7E_iH9Ru.js";import{C as se}from"./checkbox-CysNOhau.js";import{D as X,a as B,g as Y,e as G,f as V,b as J}from"./dialog-iUl0Lbwj.js";import{I as P}from"./input-8Dn7iVqx.js";import{L as re}from"./label-Cn8h1Xrd.js";import{S as T,a as de,T as me,A as Se}from"./skeleton-D4QAmAPV.js";import{S as H}from"./spinner-ZaIaI6xT.js";import{q as F,a as $}from"./index-D0-Z3Nxr.js";/* empty css            */import"./index-D_beF5mT.js";import"./index-CXB1d0w6.js";import"./check-BiMAljY0.js";import"./loader-circle-g3rXu_eV.js";const _e=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ce=L("ChevronDown",_e);const ze=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],we=L("ChevronUp",ze);const De=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],K=L("CircleX",De);const Ee=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Ae=L("Link2",Ee);const Le=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],qe=L("Pencil",Le);const Fe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ie=L("Plus",Fe);const Qe=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Te=L("Search",Qe);const He=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],$e=L("Trash2",He);const Ue=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],Oe=L("Unlink",Ue),b=e=>({url:b.url(e),method:"get"});b.definition={methods:["get","head"],url:"/api/stores/available-devices"};b.url=e=>b.definition.url+F(e);b.get=e=>({url:b.url(e),method:"get"});b.head=e=>({url:b.url(e),method:"head"});const W=e=>({action:b.url(e),method:"get"});W.get=e=>({action:b.url(e),method:"get"});W.head=e=>({action:b.url({[e?.mergeQuery?"mergeQuery":"query"]:{_method:"HEAD",...e?.query??e?.mergeQuery??{}}}),method:"get"});b.form=W;const C=(e,s)=>({url:C.url(e,s),method:"post"});C.definition={methods:["post"],url:"/api/stores/{store}/devices"};C.url=(e,s)=>{(typeof e=="string"||typeof e=="number")&&(e={store:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={store:e.id}),Array.isArray(e)&&(e={store:e[0]}),e=$(e);const r={store:typeof e.store=="object"?e.store.id:e.store};return C.definition.url.replace("{store}",r.store.toString()).replace(/\/+$/,"")+F(s)};C.post=(e,s)=>({url:C.url(e,s),method:"post"});const ue=(e,s)=>({action:C.url(e,s),method:"post"});ue.post=(e,s)=>({action:C.url(e,s),method:"post"});C.form=ue;const z=(e,s)=>({url:z.url(e,s),method:"delete"});z.definition={methods:["delete"],url:"/api/stores/{store}/devices/{device}"};z.url=(e,s)=>{Array.isArray(e)&&(e={store:e[0],device:e[1]}),e=$(e);const r={store:typeof e.store=="object"?e.store.id:e.store,device:typeof e.device=="object"?e.device.id:e.device};return z.definition.url.replace("{store}",r.store.toString()).replace("{device}",r.device.toString()).replace(/\/+$/,"")+F(s)};z.delete=(e,s)=>({url:z.url(e,s),method:"delete"});const he=(e,s)=>({action:z.url(e,{[s?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...s?.query??s?.mergeQuery??{}}}),method:"post"});he.delete=(e,s)=>({action:z.url(e,{[s?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...s?.query??s?.mergeQuery??{}}}),method:"post"});z.form=he;const le={available:Object.assign(b,b),link:Object.assign(C,C),unlink:Object.assign(z,z)},k=e=>({url:k.url(e),method:"get"});k.definition={methods:["get","head"],url:"/api/stores"};k.url=e=>k.definition.url+F(e);k.get=e=>({url:k.url(e),method:"get"});k.head=e=>({url:k.url(e),method:"head"});const Z=e=>({action:k.url(e),method:"get"});Z.get=e=>({action:k.url(e),method:"get"});Z.head=e=>({action:k.url({[e?.mergeQuery?"mergeQuery":"query"]:{_method:"HEAD",...e?.query??e?.mergeQuery??{}}}),method:"get"});k.form=Z;const w=e=>({url:w.url(e),method:"post"});w.definition={methods:["post"],url:"/api/stores"};w.url=e=>w.definition.url+F(e);w.post=e=>({url:w.url(e),method:"post"});const xe=e=>({action:w.url(e),method:"post"});xe.post=e=>({action:w.url(e),method:"post"});w.form=xe;const S=(e,s)=>({url:S.url(e,s),method:"get"});S.definition={methods:["get","head"],url:"/api/stores/{store}"};S.url=(e,s)=>{(typeof e=="string"||typeof e=="number")&&(e={store:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={store:e.id}),Array.isArray(e)&&(e={store:e[0]}),e=$(e);const r={store:typeof e.store=="object"?e.store.id:e.store};return S.definition.url.replace("{store}",r.store.toString()).replace(/\/+$/,"")+F(s)};S.get=(e,s)=>({url:S.url(e,s),method:"get"});S.head=(e,s)=>({url:S.url(e,s),method:"head"});const ee=(e,s)=>({action:S.url(e,s),method:"get"});ee.get=(e,s)=>({action:S.url(e,s),method:"get"});ee.head=(e,s)=>({action:S.url(e,{[s?.mergeQuery?"mergeQuery":"query"]:{_method:"HEAD",...s?.query??s?.mergeQuery??{}}}),method:"get"});S.form=ee;const D=(e,s)=>({url:D.url(e,s),method:"put"});D.definition={methods:["put"],url:"/api/stores/{store}"};D.url=(e,s)=>{(typeof e=="string"||typeof e=="number")&&(e={store:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={store:e.id}),Array.isArray(e)&&(e={store:e[0]}),e=$(e);const r={store:typeof e.store=="object"?e.store.id:e.store};return D.definition.url.replace("{store}",r.store.toString()).replace(/\/+$/,"")+F(s)};D.put=(e,s)=>({url:D.url(e,s),method:"put"});const fe=(e,s)=>({action:D.url(e,{[s?.mergeQuery?"mergeQuery":"query"]:{_method:"PUT",...s?.query??s?.mergeQuery??{}}}),method:"post"});fe.put=(e,s)=>({action:D.url(e,{[s?.mergeQuery?"mergeQuery":"query"]:{_method:"PUT",...s?.query??s?.mergeQuery??{}}}),method:"post"});D.form=fe;const E=(e,s)=>({url:E.url(e,s),method:"delete"});E.definition={methods:["delete"],url:"/api/stores/{store}"};E.url=(e,s)=>{(typeof e=="string"||typeof e=="number")&&(e={store:e}),typeof e=="object"&&!Array.isArray(e)&&"id"in e&&(e={store:e.id}),Array.isArray(e)&&(e={store:e[0]}),e=$(e);const r={store:typeof e.store=="object"?e.store.id:e.store};return E.definition.url.replace("{store}",r.store.toString()).replace(/\/+$/,"")+F(s)};E.delete=(e,s)=>({url:E.url(e,s),method:"delete"});const pe=(e,s)=>({action:E.url(e,{[s?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...s?.query??s?.mergeQuery??{}}}),method:"post"});pe.delete=(e,s)=>({action:E.url(e,{[s?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...s?.query??s?.mergeQuery??{}}}),method:"post"});E.form=pe;Object.assign(k,k),Object.assign(w,w),Object.assign(le,le),Object.assign(S,S),Object.assign(D,D),Object.assign(E,E);function Me(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.content;const r=`; ${document.cookie}`.split("; XSRF-TOKEN=");return r.length===2?decodeURIComponent(r.pop()?.split(";").shift()||""):""}async function q(e,s="GET",r){const i={Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"};return s!=="GET"&&s!=="HEAD"&&(i["X-CSRF-Token"]=Me()),(await fetch(e,{method:s,headers:i,credentials:"include",body:r?JSON.stringify(r):void 0})).json()}function ye(e){const s=I.c(3),{type:r}=e;switch(r){case"Hub":{let i;return s[0]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx(de,{className:"size-4"}),s[0]=i):i=s[0],i}case"THSensor":{let i;return s[1]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx(me,{className:"size-4"}),s[1]=i):i=s[1],i}default:{let i;return s[2]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx(Se,{className:"size-4"}),s[2]=i):i=s[2],i}}}function Re({store:e,open:s,onOpenChange:r,onSaved:i}){const[c,y]=o.useState(""),[n,u]=o.useState(""),[g,v]=o.useState(!1),[j,x]=o.useState(null),d=!!e;o.useEffect(()=>{s&&(y(e?.store_number||""),u(e?.store_name||""),x(null))},[s,e]);const f=async p=>{p.preventDefault(),v(!0),x(null);try{const a={store_number:c,store_name:n};let _;if(d&&e?_=await q(D.url(e.id),"PUT",a):_=await q(w.url(),"POST",a),_.success)r(!1),i();else if(_.errors){const Q=Object.values(_.errors).flat().join(", ");x(Q)}else x(_.error||_.message||"Failed to save store")}catch(a){x(a instanceof Error?a.message:"An error occurred")}finally{v(!1)}};return t.jsx(X,{open:s,onOpenChange:r,children:t.jsx(B,{className:"sm:max-w-md",children:t.jsxs("form",{onSubmit:f,children:[t.jsxs(Y,{children:[t.jsx(G,{children:d?"Edit Store":"Add Store"}),t.jsx(V,{children:d?"Update store details.":"Create a new store to link devices to."})]}),t.jsxs("div",{className:"mt-4 space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(re,{htmlFor:"store_number",children:"Store Number"}),t.jsx(P,{id:"store_number",value:c,onChange:p=>y(p.target.value),placeholder:"e.g. 03795-02",required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(re,{htmlFor:"store_name",children:"Store Name"}),t.jsx(P,{id:"store_name",value:n,onChange:p=>u(p.target.value),placeholder:"e.g. Hudson",required:!0})]}),j&&t.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-destructive/10 px-3 py-2 text-sm text-destructive",children:[t.jsx(K,{className:"size-4 shrink-0"}),j]})]}),t.jsxs(J,{className:"mt-6",children:[t.jsx(N,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:g,children:"Cancel"}),t.jsxs(N,{type:"submit",disabled:g,children:[g&&t.jsx(H,{className:"mr-2 size-4"}),d?"Update":"Create"]})]})]})})})}function Pe({store:e,open:s,onOpenChange:r,onLinked:i}){const[c,y]=o.useState([]),[n,u]=o.useState(new Set),[g,v]=o.useState(!1),[j,x]=o.useState(!1),[d,f]=o.useState(null),[p,a]=o.useState(""),_=new Set(e.devices?.map(l=>l.device_id)||[]),Q=o.useCallback(async()=>{v(!0),f(null);try{const l=await q(b.url());l.success&&l.devices?y(l.devices.map(h=>({id:h.deviceId,name:h.name,type:h.type,model:h.modelName,token:h.token}))):f(l.error||"Failed to load devices")}catch(l){f(l instanceof Error?l.message:"Failed to load devices")}finally{v(!1)}},[]);o.useEffect(()=>{s&&(u(new Set),a(""),Q())},[s,Q]);const A=c.filter(l=>!_.has(l.id)&&(l.name.toLowerCase().includes(p.toLowerCase())||l.type.toLowerCase().includes(p.toLowerCase())||l.id.toLowerCase().includes(p.toLowerCase()))),m=l=>{u(h=>{const U=new Set(h);return U.has(l)?U.delete(l):U.add(l),U})},te=()=>{n.size===A.length?u(new Set):u(new Set(A.map(l=>l.id)))},O=async()=>{if(n.size===0)return;x(!0),f(null);const l=c.filter(h=>n.has(h.id)).map(h=>({device_id:h.id,device_token:h.token,device_type:h.type,device_name:h.name,model_name:h.model,is_hub:h.type==="Hub"}));try{const h=await q(C.url(e.id),"POST",{devices:l});h.success?(r(!1),i()):f(h.error||"Failed to link devices")}catch(h){f(h instanceof Error?h.message:"Failed to link devices")}finally{x(!1)}};return t.jsx(X,{open:s,onOpenChange:r,children:t.jsxs(B,{className:"sm:max-w-lg",children:[t.jsxs(Y,{children:[t.jsxs(G,{children:["Link Devices to ",e.store_name]}),t.jsx(V,{children:"Select devices from your YoSmart account to link to this store."})]}),t.jsxs("div",{className:"mt-2 space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Te,{className:"text-muted-foreground absolute top-2.5 left-3 size-4"}),t.jsx(P,{placeholder:"Search devices...",className:"pl-9",value:p,onChange:l=>a(l.target.value)})]}),t.jsx("div",{className:"max-h-80 overflow-y-auto rounded-md border",children:g?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx(H,{className:"size-6"}),t.jsx("span",{className:"text-muted-foreground ml-2 text-sm",children:"Loading devices..."})]}):A.length===0?t.jsx("div",{className:"text-muted-foreground py-8 text-center text-sm",children:c.length===0?"No devices found in your account.":"All devices are already linked or no match found."}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-muted/50 flex items-center gap-3 border-b px-3 py-2",children:[t.jsx(se,{checked:n.size===A.length&&A.length>0,onCheckedChange:te}),t.jsx("span",{className:"text-muted-foreground text-xs font-medium",children:n.size>0?`${n.size} of ${A.length} selected`:`Select all (${A.length})`})]}),A.map(l=>t.jsxs("label",{className:"hover:bg-muted/30 flex cursor-pointer items-center gap-3 border-b px-3 py-2.5 last:border-b-0",children:[t.jsx(se,{checked:n.has(l.id),onCheckedChange:()=>m(l.id)}),t.jsx(ye,{type:l.type}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"truncate text-sm font-medium",children:l.name}),t.jsxs("div",{className:"text-muted-foreground truncate text-xs",children:[l.type," · ",l.model," · ",l.id]})]})]},l.id))]})}),_.size>0&&t.jsxs("p",{className:"text-muted-foreground text-xs",children:[_.size," device",_.size!==1?"s":""," already linked (hidden above)."]}),d&&t.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-destructive/10 px-3 py-2 text-sm text-destructive",children:[t.jsx(K,{className:"size-4 shrink-0"}),d]})]}),t.jsxs(J,{className:"mt-2",children:[t.jsx(N,{variant:"outline",onClick:()=>r(!1),disabled:j,children:"Cancel"}),t.jsxs(N,{onClick:O,disabled:j||n.size===0,children:[j&&t.jsx(H,{className:"mr-2 size-4"}),"Link ",n.size>0?`${n.size} Device${n.size!==1?"s":""}`:"Devices"]})]})]})})}function Ie({store:e,open:s,onOpenChange:r,onDeleted:i}){const[c,y]=o.useState(!1),n=async()=>{y(!0);try{(await q(E.url(e.id),"DELETE")).success&&(r(!1),i())}catch{}finally{y(!1)}};return t.jsx(X,{open:s,onOpenChange:r,children:t.jsxs(B,{className:"sm:max-w-md",children:[t.jsxs(Y,{children:[t.jsx(G,{children:"Delete Store"}),t.jsxs(V,{children:["Are you sure you want to delete ",t.jsx("strong",{children:e.store_name})," (",e.store_number,")? This will unlink all ",e.devices_count," device",e.devices_count!==1?"s":""," and cannot be undone."]})]}),t.jsxs(J,{className:"mt-4",children:[t.jsx(N,{variant:"outline",onClick:()=>r(!1),disabled:c,children:"Cancel"}),t.jsxs(N,{variant:"destructive",onClick:n,disabled:c,children:[c&&t.jsx(H,{className:"mr-2 size-4"}),"Delete Store"]})]})]})})}function Xe({store:e,onEdit:s,onDelete:r,onRefresh:i}){const[c,y]=o.useState(!1),[n,u]=o.useState(e.devices||[]),[g,v]=o.useState(!1),[j,x]=o.useState(!1),[d,f]=o.useState(null),p=o.useCallback(async()=>{v(!0);try{const m=await q(S.url(e.id));m.success&&m.store?.devices&&u(m.store.devices)}catch{}finally{v(!1)}},[e.id]);o.useEffect(()=>{c&&n.length===0&&p()},[c,n.length,p]);const a=async m=>{f(m.id);try{(await q(z.url({store:e.id,device:m.id}),"DELETE")).success&&(u(O=>O.filter(l=>l.id!==m.id)),i())}catch{}finally{f(null)}},_=()=>{p(),i()},Q=n.filter(m=>m.is_hub),A=n.filter(m=>!m.is_hub);return t.jsxs(t.Fragment,{children:[t.jsxs(M,{className:"transition-shadow hover:shadow-md",children:[t.jsx(oe,{className:"pb-3",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"bg-primary/10 text-primary flex size-10 items-center justify-center rounded-lg",children:t.jsx(ae,{className:"size-5"})}),t.jsxs("div",{children:[t.jsx(be,{className:"text-base",children:e.store_name}),t.jsx(ke,{className:"font-mono text-xs",children:e.store_number})]})]}),t.jsx("div",{className:"flex items-center gap-1",children:t.jsx(ce,{variant:e.is_active?"default":"secondary",className:"text-xs",children:e.is_active?"Active":"Inactive"})})]})}),t.jsxs(R,{className:"space-y-3",children:[t.jsxs("div",{className:"flex gap-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(de,{className:"text-muted-foreground size-3.5"}),t.jsxs("span",{className:"text-muted-foreground",children:[e.hubs_count," hub",e.hubs_count!==1?"s":""]})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(me,{className:"text-muted-foreground size-3.5"}),t.jsxs("span",{className:"text-muted-foreground",children:[e.sensors_count," sensor",e.sensors_count!==1?"s":""]})]})]}),t.jsx(ve,{}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs(N,{size:"sm",variant:"outline",onClick:()=>x(!0),children:[t.jsx(Ae,{className:"mr-1.5 size-3.5"}),"Link Devices"]}),t.jsxs(N,{size:"sm",variant:"outline",onClick:s,children:[t.jsx(qe,{className:"mr-1.5 size-3.5"}),"Edit"]}),t.jsxs(N,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:r,children:[t.jsx($e,{className:"mr-1.5 size-3.5"}),"Delete"]}),t.jsx("div",{className:"flex-1"}),t.jsx(N,{size:"sm",variant:"ghost",onClick:()=>y(!c),className:"text-muted-foreground",children:c?t.jsxs(t.Fragment,{children:[t.jsx(we,{className:"mr-1 size-3.5"})," Hide Devices"]}):t.jsxs(t.Fragment,{children:[t.jsx(Ce,{className:"mr-1 size-3.5"})," Show Devices (",e.devices_count,")"]})})]}),c&&t.jsx("div",{className:"mt-2 space-y-2",children:g?t.jsx("div",{className:"space-y-2",children:[1,2,3].map(m=>t.jsx(T,{className:"h-12 w-full rounded-md"},m))}):n.length===0?t.jsx("div",{className:"text-muted-foreground rounded-md border border-dashed py-6 text-center text-sm",children:'No devices linked yet. Click "Link Devices" to get started.'}):t.jsxs(t.Fragment,{children:[Q.length>0&&t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-muted-foreground text-xs font-medium uppercase tracking-wide",children:"Hub"}),Q.map(m=>t.jsx(ne,{device:m,unlinking:d===m.id,onUnlink:()=>a(m)},m.id))]}),A.length>0&&t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-muted-foreground text-xs font-medium uppercase tracking-wide",children:"Sensors"}),A.map(m=>t.jsx(ne,{device:m,unlinking:d===m.id,onUnlink:()=>a(m)},m.id))]})]})})]})]}),t.jsx(Pe,{store:{...e,devices:n},open:j,onOpenChange:x,onLinked:_})]})}function ne(e){const s=I.c(28),{device:r,unlinking:i,onUnlink:c}=e;let y;s[0]!==r.device_type?(y=t.jsx(ye,{type:r.device_type}),s[0]=r.device_type,s[1]=y):y=s[1];let n;s[2]!==r.device_name?(n=t.jsx("div",{className:"truncate text-sm font-medium",children:r.device_name}),s[2]=r.device_name,s[3]=n):n=s[3];let u;s[4]!==r.model_name?(u=r.model_name&&t.jsxs(t.Fragment,{children:[" · ",r.model_name]}),s[4]=r.model_name,s[5]=u):u=s[5];let g;s[6]!==r.device_id?(g=t.jsx("span",{className:"ml-1 font-mono opacity-60",children:r.device_id}),s[6]=r.device_id,s[7]=g):g=s[7];let v;s[8]!==r.device_type||s[9]!==u||s[10]!==g?(v=t.jsxs("div",{className:"text-muted-foreground truncate text-xs",children:[r.device_type,u,g]}),s[8]=r.device_type,s[9]=u,s[10]=g,s[11]=v):v=s[11];let j;s[12]!==n||s[13]!==v?(j=t.jsxs("div",{className:"min-w-0 flex-1",children:[n,v]}),s[12]=n,s[13]=v,s[14]=j):j=s[14];let x;s[15]!==r.is_hub?(x=r.is_hub&&t.jsx(ce,{variant:"outline",className:"text-xs",children:"Hub"}),s[15]=r.is_hub,s[16]=x):x=s[16];let d;s[17]!==i?(d=i?t.jsx(H,{className:"size-3.5"}):t.jsx(Oe,{className:"size-3.5"}),s[17]=i,s[18]=d):d=s[18];let f;s[19]!==c||s[20]!==d||s[21]!==i?(f=t.jsx(N,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-destructive size-8 p-0",onClick:c,disabled:i,title:"Unlink device",children:d}),s[19]=c,s[20]=d,s[21]=i,s[22]=f):f=s[22];let p;return s[23]!==y||s[24]!==j||s[25]!==x||s[26]!==f?(p=t.jsxs("div",{className:"bg-muted/40 flex items-center gap-3 rounded-md px-3 py-2",children:[y,j,x,f]}),s[23]=y,s[24]=j,s[25]=x,s[26]=f,s[27]=p):p=s[27],p}function Be(){const[e,s]=o.useState([]),[r,i]=o.useState(!0),[c,y]=o.useState(null),[n,u]=o.useState(!1),[g,v]=o.useState(null),[j,x]=o.useState(null),d=o.useCallback(async()=>{try{i(!0),y(null);const a=await q(k.url());a.success&&a.stores?s(a.stores):y(a.error||"Failed to load stores")}catch(a){y(a instanceof Error?a.message:"Failed to load stores")}finally{i(!1)}},[]);o.useEffect(()=>{d()},[d]);const f=()=>{v(null),u(!0)},p=a=>{v(a),u(!0)};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Stores"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:"Manage your stores and link YoSmart devices to each location."})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(N,{variant:"outline",size:"sm",onClick:d,disabled:r,children:[t.jsx(Ne,{className:`mr-1.5 size-3.5 ${r?"animate-spin":""}`}),"Refresh"]}),t.jsxs(N,{size:"sm",onClick:f,children:[t.jsx(ie,{className:"mr-1.5 size-3.5"}),"Add Store"]})]})]}),c&&t.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-destructive/10 px-4 py-3 text-sm text-destructive",children:[t.jsx(K,{className:"size-4 shrink-0"}),c,t.jsx(N,{variant:"ghost",size:"sm",className:"ml-auto",onClick:d,children:"Retry"})]}),r&&e.length===0&&t.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[1,2,3].map(a=>t.jsxs(M,{children:[t.jsx(oe,{className:"pb-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(T,{className:"size-10 rounded-lg"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(T,{className:"h-4 w-32"}),t.jsx(T,{className:"h-3 w-20"})]})]})}),t.jsxs(R,{children:[t.jsx(T,{className:"h-4 w-40"}),t.jsx(T,{className:"mt-3 h-8 w-full"})]})]},a))}),!r&&e.length===0&&!c&&t.jsx(M,{className:"border-dashed",children:t.jsxs(R,{className:"flex flex-col items-center justify-center py-12",children:[t.jsx("div",{className:"bg-muted mb-4 flex size-16 items-center justify-center rounded-full",children:t.jsx(ae,{className:"text-muted-foreground size-8"})}),t.jsx("h3",{className:"text-lg font-semibold",children:"No stores yet"}),t.jsx("p",{className:"text-muted-foreground mt-1 text-sm",children:"Create your first store to start linking YoSmart devices."}),t.jsxs(N,{className:"mt-4",onClick:f,children:[t.jsx(ie,{className:"mr-1.5 size-4"}),"Add Your First Store"]})]})}),e.length>0&&t.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:e.map(a=>t.jsx(Xe,{store:a,onEdit:()=>p(a),onDelete:()=>x(a),onRefresh:d},a.id))}),t.jsx(Re,{store:g,open:n,onOpenChange:u,onSaved:d}),j&&t.jsx(Ie,{store:j,open:!!j,onOpenChange:a=>!a&&x(null),onDeleted:d})]})}const Ye=[{title:"Dashboard",href:"/dashboard"},{title:"Stores",href:"/stores"}];function dt(){const e=I.c(2);let s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=t.jsx(je,{title:"Store Management"}),e[0]=s):s=e[0];let r;return e[1]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsxs(ge,{breadcrumbs:Ye,children:[s,t.jsx("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-auto rounded-xl p-4 md:p-6",children:t.jsx(Be,{})})]}),e[1]=r):r=e[1],r}export{dt as default};
