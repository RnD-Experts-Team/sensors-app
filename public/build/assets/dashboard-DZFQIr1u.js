import{r as T,j as t,c as C,H as ne}from"./app-CcQem-as.js";import{T as Y,a as W,b as X,S as ie,A as oe}from"./app-layout-DquRM7Xy.js";import{C as $,a as I,b as G,c as J,d as H,R as B,B as q}from"./badge-GIPNTP_w.js";import{a as _,B as U}from"./app-logo-icon-7E_iH9Ru.js";import{S as F,A as Z,a as V,T as Q}from"./skeleton-D4QAmAPV.js";import{S as O}from"./spinner-ZaIaI6xT.js";import{C as ee}from"./circle-alert-DejV7wOJ.js";import{d as ce}from"./index-D0-Z3Nxr.js";/* empty css            */import"./index-D_beF5mT.js";import"./index-CXB1d0w6.js";import"./loader-circle-g3rXu_eV.js";const de=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}],["line",{x1:"10",x2:"10",y1:"11",y2:"13",key:"haxvl5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"13",key:"c6fn6x"}]],me=_("BatteryFull",de);const xe=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}]],ue=_("BatteryLow",xe);const he=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}],["line",{x1:"10",x2:"10",y1:"11",y2:"13",key:"haxvl5"}]],fe=_("BatteryMedium",he);const pe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],ge=_("Clock",pe);const je=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],ye=_("Droplets",je);const Ne=[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]],be=_("Signal",Ne);const ve=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],ke=_("Snowflake",ve);const we=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],K=_("WifiOff",we);const Se=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],te=_("Wifi",Se);function ae(){const r=document.querySelector('meta[name="csrf-token"]');if(r)return r.content;const s=`; ${document.cookie}`.split("; XSRF-TOKEN=");return s.length===2&&s.pop()?.split(";").shift()||""}async function ze(){try{const r=await fetch("/api/yosmart/devices",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(r){return console.error("Failed to fetch YoSmart devices:",r),{success:!1,error:r instanceof Error?r.message:"Failed to fetch devices"}}}async function Te(){try{const r=await fetch("/api/yosmart/home",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(r){return console.error("Failed to fetch YoSmart home info:",r),{success:!1,error:r instanceof Error?r.message:"Failed to fetch home info"}}}async function Ce(r,e,a){try{const s={deviceId:r,deviceToken:e,...a&&{deviceType:a}},i=await fetch("/api/yosmart/device/state",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":ae()},credentials:"include",body:JSON.stringify(s)}),l=await i.json();return!i.ok&&!l.success?{success:!1,error:l.hint||l.error||`HTTP ${i.status}`,code:l.code}:l}catch(s){return console.error(`Failed to get state for device ${r}:`,s),{success:!1,error:s instanceof Error?s.message:"Failed to get device state"}}}async function _e(r,e,a,s){try{const i=await fetch("/api/yosmart/device/control",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":ae()},credentials:"include",body:JSON.stringify({deviceId:r,method:e,params:a||{},token:s})});if(!i.ok)throw new Error(`HTTP ${i.status}`);return await i.json()}catch(i){return console.error(`Failed to control device ${r}:`,i),{success:!1,error:i instanceof Error?i.message:"Failed to control device"}}}async function Fe(){try{const r=await fetch("/api/yosmart/device/states",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"}),e=await r.json();return!r.ok&&!e.success?{success:!1,error:e.error||`HTTP ${r.status}`}:e}catch(r){return console.error("Failed to fetch all device states:",r),{success:!1,error:r instanceof Error?r.message:"Failed to fetch device states"}}}function $e(){const[r,e]=T.useState([]),[a,s]=T.useState(null),[i,l]=T.useState({}),[f,d]=T.useState(!0),[p,m]=T.useState(null),[x,u]=T.useState(null),o=T.useCallback(async()=>{try{d(!0),m(null);const n=await ze();n.success&&n.devices?(e(n.devices),u(new Date)):(m(n.error||"Failed to load devices"),e([]))}catch(n){const S=n instanceof Error?n.message:"Unknown error";m(S),e([])}finally{d(!1)}},[]),c=T.useCallback(async()=>{try{const n=await Te();n.success&&n.home?s(n.home.homeId||n.home.id):console.warn("Failed to load home info:",n.error)}catch(n){console.error("Home info error:",n)}},[]),N=T.useCallback(async(n,S,g)=>{try{l(j=>({...j,[n]:{...j[n]||{loading:!1,state:null,error:null,lastUpdated:null},loading:!0,error:null}}));const h=await Ce(n,S,g);if(h.success&&h.state)return l(j=>({...j,[n]:{loading:!1,state:h.state,error:null,lastUpdated:new Date}})),h.state;{const j=h.error||"Failed to get state";return l(b=>({...b,[n]:{...b[n]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:j}})),null}}catch(h){const j=h instanceof Error?h.message:"Unknown error";return l(b=>({...b,[n]:{...b[n]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:j}})),null}},[]),v=T.useCallback(async(n,S,g,h)=>{try{l(b=>({...b,[n]:{...b[n]||{loading:!1,state:null,error:null,lastUpdated:null},loading:!0,error:null}}));const j=await _e(n,S,g,h);if(j.success&&j.data)return l(b=>({...b,[n]:{loading:!1,state:j.data,error:null,lastUpdated:new Date}})),j.data;{const b=j.error||"Failed to control device";return l(z=>({...z,[n]:{...z[n]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:b}})),null}}catch(j){const b=j instanceof Error?j.message:"Unknown error";return l(z=>({...z,[n]:{...z[n]||{loading:!1,state:null,lastUpdated:null},loading:!1,error:b}})),null}},[]),y=T.useCallback(()=>{o(),c()},[o,c]),k=T.useCallback(async()=>{try{l(S=>{const g={...S};return r.forEach(h=>{g[h.deviceId]={...S[h.deviceId]||{state:null,error:null,lastUpdated:null},loading:!0,error:null}}),g});const n=await Fe();if(n.success&&n.devices){const S={};for(const g of n.devices)S[g.deviceId]={loading:!1,state:g.success?g.state:null,error:g.success?null:g.error||"Failed",lastUpdated:g.success?new Date:null};l(S),e(n.devices.map(g=>({deviceId:g.deviceId,name:g.name,type:g.deviceType,modelName:g.modelName||"",...g}))),u(new Date)}else console.error("Failed to fetch all device states:",n.error)}catch(n){console.error("fetchAllStates error:",n)}},[r]);T.useEffect(()=>{o(),c()},[o,c]);const w=T.useCallback(n=>i[n]||{loading:!1,state:null,error:null,lastUpdated:null},[i]);return{devices:r,homeId:a,deviceStates:i,loading:f,error:p,lastSync:x,refresh:y,getState:N,control:v,getDeviceStatus:w,fetchAllStates:k}}function He(r){return r*9/5+32}function De(r,e){return e==="c"?`${r.toFixed(1)}°C`:`${r.toFixed(1)}°`}function Me(r){return r?new Date(r).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function le(r){const e=Math.floor((Date.now()-r.getTime())/1e3);if(e<60)return"just now";const a=Math.floor(e/60);if(a<60)return`${a}m ago`;const s=Math.floor(a/60);return s<24?`${s}h ago`:`${Math.floor(s/24)}d ago`}function Le(r){const e=C.c(3),{level:a}=r;if(a<=1){let i;return e[0]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx(ue,{className:"size-4 text-red-500"}),e[0]=i):i=e[0],i}if(a<=2){let i;return e[1]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx(fe,{className:"size-4 text-amber-500"}),e[1]=i):i=e[1],i}let s;return e[2]===Symbol.for("react.memo_cache_sentinel")?(s=t.jsx(me,{className:"size-4 text-emerald-500"}),e[2]=s):s=e[2],s}function se(r){return{0:"0%",1:"25%",2:"50%",3:"75%",4:"100%"}[r]??`${r}`}function Ae(r,e){const a=e==="c"?He(r):r;return a<=0?"text-blue-600 dark:text-blue-400":a<=32?"text-sky-600 dark:text-sky-400":a<=60?"text-teal-600 dark:text-teal-400":a<=80?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}function Re(r){switch(r){case"THSensor":return t.jsx(Q,{className:"size-5"});case"Hub":return t.jsx(V,{className:"size-5"});default:return t.jsx(Z,{className:"size-5"})}}function Ee(r){const e=C.c(13),{icon:a,label:s,value:i,valueClass:l}=r;let f;e[0]!==a?(f=t.jsx("span",{className:"text-muted-foreground",children:a}),e[0]=a,e[1]=f):f=e[1];let d;e[2]!==s?(d=t.jsx("span",{className:"text-[11px] uppercase tracking-wider text-muted-foreground",children:s}),e[2]=s,e[3]=d):d=e[3];const p=l??"text-sm font-semibold";let m;e[4]!==p||e[5]!==i?(m=t.jsx("span",{className:p,children:i}),e[4]=p,e[5]=i,e[6]=m):m=e[6];let x;e[7]!==d||e[8]!==m?(x=t.jsxs("div",{className:"flex flex-col",children:[d,m]}),e[7]=d,e[8]=m,e[9]=x):x=e[9];let u;return e[10]!==f||e[11]!==x?(u=t.jsxs("div",{className:"flex items-center gap-2",children:[f,x]}),e[10]=f,e[11]=x,e[12]=u):u=e[12],u}function Ue(){const r=C.c(3);let e;r[0]===Symbol.for("react.memo_cache_sentinel")?(e=t.jsx(F,{className:"size-10 rounded-lg"}),r[0]=e):e=r[0];let a;r[1]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(I,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center gap-3",children:[e,t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx(F,{className:"h-4 w-28"}),t.jsx(F,{className:"h-3 w-20"})]}),t.jsx(F,{className:"h-5 w-14 rounded-full"})]})}),r[1]=a):a=r[1];let s;return r[2]===Symbol.for("react.memo_cache_sentinel")?(s=t.jsxs($,{className:"overflow-hidden",children:[a,t.jsxs(H,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(F,{className:"h-16 rounded-lg"}),t.jsx(F,{className:"h-16 rounded-lg"})]}),t.jsx(F,{className:"h-8 w-full rounded-lg"})]})]}),r[2]=s):s=r[2],s}function Oe(r){const e=C.c(34),{devices:a,deviceStates:s}=r,i=a.length;let l;if(e[0]!==s||e[1]!==a){let h;e[3]!==s?(h=j=>s[j.deviceId]?.state?.online===!0,e[3]=s,e[4]=h):h=e[4],l=a.filter(h),e[0]=s,e[1]=a,e[2]=l}else l=e[2];const f=l.length;let d;if(e[5]!==s||e[6]!==a){let h;e[8]!==s?(h=j=>{const b=s[j.deviceId];return b?.state&&b.state.online===!1},e[8]=s,e[9]=h):h=e[9],d=a.filter(h),e[5]=s,e[6]=a,e[7]=d}else d=e[7];const p=d.length;let m;if(e[10]!==s||e[11]!==a){let h;e[13]!==s?(h=j=>{const z=s[j.deviceId]?.state?.state?.alarm;return z?z.lowBattery||z.lowTemp||z.highTemp||z.lowHumidity||z.highHumidity:!1},e[13]=s,e[14]=h):h=e[14],m=a.filter(h),e[10]=s,e[11]=a,e[12]=m}else m=e[12];const x=m.length;let u;e[15]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(Z,{className:"size-4"}),e[15]=u):u=e[15];let o;e[16]!==i?(o={label:"Total Devices",value:i,icon:u,color:"text-foreground",bg:"bg-muted/50"},e[16]=i,e[17]=o):o=e[17];let c;e[18]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx(te,{className:"size-4 text-emerald-500"}),e[18]=c):c=e[18];let N;e[19]!==f?(N={label:"Online",value:f,icon:c,color:"text-emerald-600 dark:text-emerald-400",bg:"bg-emerald-50 dark:bg-emerald-950/30"},e[19]=f,e[20]=N):N=e[20];let v;e[21]===Symbol.for("react.memo_cache_sentinel")?(v=t.jsx(K,{className:"size-4 text-red-500"}),e[21]=v):v=e[21];let y;e[22]!==p?(y={label:"Offline",value:p,icon:v,color:"text-red-600 dark:text-red-400",bg:"bg-red-50 dark:bg-red-950/30"},e[22]=p,e[23]=y):y=e[23];let k;e[24]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx(ee,{className:"size-4 text-amber-500"}),e[24]=k):k=e[24];let w;e[25]!==x?(w={label:"Alerts",value:x,icon:k,color:"text-amber-600 dark:text-amber-400",bg:"bg-amber-50 dark:bg-amber-950/30"},e[25]=x,e[26]=w):w=e[26];let n;e[27]!==w||e[28]!==o||e[29]!==N||e[30]!==y?(n=[o,N,y,w],e[27]=w,e[28]=o,e[29]=N,e[30]=y,e[31]=n):n=e[31];const S=n;let g;return e[32]!==S?(g=t.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:S.map(Be)}),e[32]=S,e[33]=g):g=e[33],g}function Be(r){return t.jsx($,{className:`${r.bg} border-0 shadow-none py-4`,children:t.jsxs(H,{className:"flex items-center gap-3 px-4 py-0",children:[r.icon,t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-muted-foreground",children:r.label}),t.jsx("p",{className:`text-xl font-bold ${r.color}`,children:r.value})]})]})},r.label)}function Ie(r){const e=C.c(50),{device:a,status:s,onRefresh:i}=r,l=s.state,f=l?.online,d=l?.state,p=l?.reportAt,m=d?.temperature,x=d?.humidity,u=d?.battery,o=d?.mode,c=d?.alarm,N=c&&(c.lowBattery||c.lowTemp||c.highTemp||c.lowHumidity||c.highHumidity),v=m!==void 0&&m<=32&&o!=="c",y=m!==void 0&&m<=0&&o==="c",k=`flex size-10 items-center justify-center rounded-lg ${v||y?"bg-blue-100 text-blue-600 dark:bg-blue-900/40 dark:text-blue-400":"bg-orange-100 text-orange-600 dark:bg-orange-900/40 dark:text-orange-400"}`;let w;e[0]!==v||e[1]!==y?(w=v||y?t.jsx(ke,{className:"size-5"}):t.jsx(Q,{className:"size-5"}),e[0]=v,e[1]=y,e[2]=w):w=e[2];let n;e[3]!==k||e[4]!==w?(n=t.jsx("div",{className:k,children:w}),e[3]=k,e[4]=w,e[5]=n):n=e[5];let S;e[6]!==a.name?(S=t.jsx(G,{className:"text-base",children:a.name}),e[6]=a.name,e[7]=S):S=e[7];let g;e[8]!==a.modelName?(g=t.jsx(J,{className:"text-xs",children:a.modelName}),e[8]=a.modelName,e[9]=g):g=e[9];let h;e[10]!==S||e[11]!==g?(h=t.jsxs("div",{children:[S,g]}),e[10]=S,e[11]=g,e[12]=h):h=e[12];let j;e[13]!==n||e[14]!==h?(j=t.jsxs("div",{className:"flex items-center gap-3",children:[n,h]}),e[13]=n,e[14]=h,e[15]=j):j=e[15];let b;e[16]!==c||e[17]!==N?(b=N&&t.jsxs(Y,{children:[t.jsx(W,{children:t.jsxs(q,{variant:"destructive",className:"gap-1 text-[10px]",children:[t.jsx(ee,{className:"size-3"})," Alert"]})}),t.jsxs(X,{children:[c.lowTemp&&t.jsx("p",{children:"Low temperature alarm"}),c.highTemp&&t.jsx("p",{children:"High temperature alarm"}),c.lowBattery&&t.jsx("p",{children:"Low battery"}),c.lowHumidity&&t.jsx("p",{children:"Low humidity alarm"}),c.highHumidity&&t.jsx("p",{children:"High humidity alarm"})]})]}),e[16]=c,e[17]=N,e[18]=b):b=e[18];let z;e[19]!==l||e[20]!==f?(z=l?t.jsx(q,{variant:f?"secondary":"destructive",className:`text-[10px] ${f?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":""}`,children:f?t.jsxs(t.Fragment,{children:[t.jsx(te,{className:"size-3"})," Online"]}):t.jsxs(t.Fragment,{children:[t.jsx(K,{className:"size-3"})," Offline"]})}):null,e[19]=l,e[20]=f,e[21]=z):z=e[21];let D;e[22]!==b||e[23]!==z?(D=t.jsxs("div",{className:"flex items-center gap-1.5",children:[b,z]}),e[22]=b,e[23]=z,e[24]=D):D=e[24];let M;e[25]!==D||e[26]!==j?(M=t.jsx(I,{className:"pb-3",children:t.jsxs("div",{className:"flex items-start justify-between",children:[j,D]})}),e[25]=D,e[26]=j,e[27]=M):M=e[27];let L;e[28]!==u||e[29]!==l||e[30]!==x||e[31]!==o||e[32]!==p||e[33]!==d||e[34]!==s.error||e[35]!==s.loading||e[36]!==m?(L=s.loading&&!l?t.jsxs("div",{className:"flex items-center justify-center py-6 text-muted-foreground",children:[t.jsx(O,{className:"size-5 mr-2"}),t.jsx("span",{className:"text-sm",children:"Fetching sensor data…"})]}):s.error&&!l?t.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-950/30",children:t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:s.error})}):l?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-end justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[11px] uppercase tracking-wider text-muted-foreground mb-0.5",children:"Temperature"}),t.jsx("p",{className:`text-3xl font-bold tabular-nums leading-none ${Ae(m,o)}`,children:De(m,o)})]}),x!==void 0&&x>0&&t.jsx(Ee,{icon:t.jsx(ye,{className:"size-4 text-sky-500"}),label:"Humidity",value:`${x}%`,valueClass:"text-sm font-semibold text-sky-600 dark:text-sky-400"})]}),t.jsx(ie,{}),t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs(Y,{children:[t.jsx(W,{asChild:!0,children:t.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[t.jsx(Le,{level:u??0}),t.jsx("span",{children:se(u??0)})]})}),t.jsxs(X,{children:["Battery level: ",se(u??0)]})]}),d?.loraInfo&&t.jsxs(Y,{children:[t.jsx(W,{asChild:!0,children:t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(be,{className:"size-3.5"}),t.jsx("span",{children:d.loraInfo.devNetType})]})}),t.jsxs(X,{children:["LoRa network type ",d.loraInfo.devNetType]})]}),t.jsxs(Y,{children:[t.jsx(W,{asChild:!0,children:t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(ge,{className:"size-3.5"}),t.jsx("span",{children:Me(p)})]})}),t.jsxs(X,{children:["Last report: ",p??"unknown"]})]})]}),d?.tempLimit&&d.tempLimit.min>-999&&t.jsxs("div",{className:"rounded-md bg-muted/50 px-3 py-1.5 text-[11px] text-muted-foreground",children:["Temp range: ",d.tempLimit.min,"° — ",d.tempLimit.max,"°"]})]}):t.jsxs("div",{className:"flex flex-col items-center gap-2 py-6 text-center text-muted-foreground",children:[t.jsx(Q,{className:"size-8 opacity-30"}),t.jsx("p",{className:"text-sm",children:"No data yet"})]}),e[28]=u,e[29]=l,e[30]=x,e[31]=o,e[32]=p,e[33]=d,e[34]=s.error,e[35]=s.loading,e[36]=m,e[37]=L):L=e[37];let A;e[38]!==s.loading?(A=s.loading?t.jsxs(t.Fragment,{children:[t.jsx(O,{className:"size-3.5"}),t.jsx("span",{children:"Updating…"})]}):t.jsxs(t.Fragment,{children:[t.jsx(B,{className:"size-3.5"}),t.jsx("span",{children:"Refresh"})]}),e[38]=s.loading,e[39]=A):A=e[39];let R;e[40]!==i||e[41]!==s.loading||e[42]!==A?(R=t.jsx(U,{variant:"outline",size:"sm",className:"w-full",onClick:i,disabled:s.loading,children:A}),e[40]=i,e[41]=s.loading,e[42]=A,e[43]=R):R=e[43];let E;e[44]!==L||e[45]!==R?(E=t.jsxs(H,{className:"space-y-3 pb-4",children:[L,R]}),e[44]=L,e[45]=R,e[46]=E):E=e[46];let P;return e[47]!==M||e[48]!==E?(P=t.jsxs($,{className:"group overflow-hidden transition-shadow hover:shadow-md",children:[M,E]}),e[47]=M,e[48]=E,e[49]=P):P=e[49],P}function Pe(r){const e=C.c(31),{device:a,status:s,onRefresh:i}=r,l=s.state,f=l?.online;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=t.jsx("div",{className:"flex size-10 items-center justify-center rounded-lg bg-violet-100 text-violet-600 dark:bg-violet-900/40 dark:text-violet-400",children:t.jsx(V,{className:"size-5"})}),e[0]=d):d=e[0];let p;e[1]!==a.name?(p=t.jsx(G,{className:"text-base",children:a.name}),e[1]=a.name,e[2]=p):p=e[2];let m;e[3]!==a.modelName?(m=t.jsx(J,{className:"text-xs",children:a.modelName}),e[3]=a.modelName,e[4]=m):m=e[4];let x;e[5]!==p||e[6]!==m?(x=t.jsxs("div",{className:"flex items-center gap-3",children:[d,t.jsxs("div",{children:[p,m]})]}),e[5]=p,e[6]=m,e[7]=x):x=e[7];let u;e[8]!==l||e[9]!==f?(u=l?t.jsx(q,{variant:f?"secondary":"destructive",className:`text-[10px] ${f?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":""}`,children:f?t.jsxs(t.Fragment,{children:[t.jsx(te,{className:"size-3"})," Online"]}):t.jsxs(t.Fragment,{children:[t.jsx(K,{className:"size-3"})," Offline"]})}):null,e[8]=l,e[9]=f,e[10]=u):u=e[10];let o;e[11]!==x||e[12]!==u?(o=t.jsx(I,{className:"pb-3",children:t.jsxs("div",{className:"flex items-start justify-between",children:[x,u]})}),e[11]=x,e[12]=u,e[13]=o):o=e[13];let c;e[14]!==l||e[15]!==s.error||e[16]!==s.lastUpdated||e[17]!==s.loading?(c=s.loading&&!l?t.jsxs("div",{className:"flex items-center justify-center py-4 text-muted-foreground",children:[t.jsx(O,{className:"size-5 mr-2"}),t.jsx("span",{className:"text-sm",children:"Fetching hub status…"})]}):s.error&&!l?t.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-950/30",children:t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:s.error})}):l?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"rounded-lg bg-muted/50 p-3",children:[t.jsx("p",{className:"text-xs text-muted-foreground",children:"Hub is the central bridge connecting all YoLink sensors."}),l.state?.version&&t.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Firmware: ",t.jsx("span",{className:"font-mono",children:l.state.version})]}),l.state?.wifi&&t.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["WiFi SSID: ",t.jsx("span",{className:"font-medium",children:l.state.wifi.ssid})]})]}),s.lastUpdated&&t.jsxs("p",{className:"text-[11px] text-muted-foreground text-right",children:["Updated ",le(s.lastUpdated)]})]}):t.jsxs("div",{className:"flex flex-col items-center gap-2 py-4 text-center text-muted-foreground",children:[t.jsx(V,{className:"size-8 opacity-30"}),t.jsx("p",{className:"text-sm",children:"No data yet"})]}),e[14]=l,e[15]=s.error,e[16]=s.lastUpdated,e[17]=s.loading,e[18]=c):c=e[18];let N;e[19]!==s.loading?(N=s.loading?t.jsxs(t.Fragment,{children:[t.jsx(O,{className:"size-3.5"}),t.jsx("span",{children:"Updating…"})]}):t.jsxs(t.Fragment,{children:[t.jsx(B,{className:"size-3.5"}),t.jsx("span",{children:"Refresh"})]}),e[19]=s.loading,e[20]=N):N=e[20];let v;e[21]!==i||e[22]!==s.loading||e[23]!==N?(v=t.jsx(U,{variant:"outline",size:"sm",className:"mt-3 w-full",onClick:i,disabled:s.loading,children:N}),e[21]=i,e[22]=s.loading,e[23]=N,e[24]=v):v=e[24];let y;e[25]!==c||e[26]!==v?(y=t.jsxs(H,{className:"pb-4",children:[c,v]}),e[25]=c,e[26]=v,e[27]=y):y=e[27];let k;return e[28]!==y||e[29]!==o?(k=t.jsxs($,{className:"overflow-hidden border-2 border-dashed transition-shadow hover:shadow-md",children:[o,y]}),e[28]=y,e[29]=o,e[30]=k):k=e[30],k}function Ye(r){const e=C.c(37),{device:a,status:s,onRefresh:i}=r,l=s.state,f=l?.online;let d;e[0]!==a.type?(d=Re(a.type),e[0]=a.type,e[1]=d):d=e[1];let p;e[2]!==d?(p=t.jsx("div",{className:"flex size-10 items-center justify-center rounded-lg bg-muted text-muted-foreground",children:d}),e[2]=d,e[3]=p):p=e[3];let m;e[4]!==a.name?(m=t.jsx(G,{className:"text-base",children:a.name}),e[4]=a.name,e[5]=m):m=e[5];let x;e[6]!==a.modelName||e[7]!==a.type?(x=t.jsxs(J,{className:"text-xs",children:[a.type," · ",a.modelName]}),e[6]=a.modelName,e[7]=a.type,e[8]=x):x=e[8];let u;e[9]!==m||e[10]!==x?(u=t.jsxs("div",{children:[m,x]}),e[9]=m,e[10]=x,e[11]=u):u=e[11];let o;e[12]!==p||e[13]!==u?(o=t.jsxs("div",{className:"flex items-center gap-3",children:[p,u]}),e[12]=p,e[13]=u,e[14]=o):o=e[14];let c;e[15]!==l||e[16]!==f?(c=l!=null&&t.jsx(q,{variant:f?"secondary":"destructive",className:`text-[10px] ${f?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400":""}`,children:f?"Online":"Offline"}),e[15]=l,e[16]=f,e[17]=c):c=e[17];let N;e[18]!==o||e[19]!==c?(N=t.jsx(I,{className:"pb-3",children:t.jsxs("div",{className:"flex items-start justify-between",children:[o,c]})}),e[18]=o,e[19]=c,e[20]=N):N=e[20];let v;e[21]!==l||e[22]!==s.error||e[23]!==s.loading?(v=s.loading&&!l?t.jsxs("div",{className:"flex items-center justify-center py-4 text-muted-foreground",children:[t.jsx(O,{className:"size-5 mr-2"}),t.jsx("span",{className:"text-sm",children:"Loading…"})]}):l?t.jsx("div",{className:"rounded-lg bg-muted/40 p-3",children:t.jsx("pre",{className:"text-xs text-muted-foreground overflow-auto max-h-40 whitespace-pre-wrap break-words",children:JSON.stringify(l.state||l,null,2)})}):s.error?t.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 dark:border-red-800 dark:bg-red-950/30",children:t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:s.error})}):t.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No data yet"}),e[21]=l,e[22]=s.error,e[23]=s.loading,e[24]=v):v=e[24];let y;e[25]!==s.loading?(y=s.loading?t.jsxs(t.Fragment,{children:[t.jsx(O,{className:"size-3.5"}),t.jsx("span",{children:"Updating…"})]}):t.jsxs(t.Fragment,{children:[t.jsx(B,{className:"size-3.5"}),t.jsx("span",{children:"Refresh"})]}),e[25]=s.loading,e[26]=y):y=e[26];let k;e[27]!==i||e[28]!==s.loading||e[29]!==y?(k=t.jsx(U,{variant:"outline",size:"sm",className:"mt-3 w-full",onClick:i,disabled:s.loading,children:y}),e[27]=i,e[28]=s.loading,e[29]=y,e[30]=k):k=e[30];let w;e[31]!==k||e[32]!==v?(w=t.jsxs(H,{className:"pb-4",children:[v,k]}),e[31]=k,e[32]=v,e[33]=w):w=e[33];let n;return e[34]!==w||e[35]!==N?(n=t.jsxs($,{className:"overflow-hidden transition-shadow hover:shadow-md",children:[N,w]}),e[34]=w,e[35]=N,e[36]=n):n=e[36],n}function re(r){const e=C.c(12),{device:a,status:s,onRefresh:i}=r;switch(a.type){case"THSensor":{let l;return e[0]!==a||e[1]!==i||e[2]!==s?(l=t.jsx(Ie,{device:a,status:s,onRefresh:i}),e[0]=a,e[1]=i,e[2]=s,e[3]=l):l=e[3],l}case"Hub":{let l;return e[4]!==a||e[5]!==i||e[6]!==s?(l=t.jsx(Pe,{device:a,status:s,onRefresh:i}),e[4]=a,e[5]=i,e[6]=s,e[7]=l):l=e[7],l}default:{let l;return e[8]!==a||e[9]!==i||e[10]!==s?(l=t.jsx(Ye,{device:a,status:s,onRefresh:i}),e[8]=a,e[9]=i,e[10]=s,e[11]=l):l=e[11],l}}}function We(){const{devices:r,deviceStates:e,loading:a,error:s,refresh:i,lastSync:l,fetchAllStates:f,getState:d,getDeviceStatus:p}=$e();if(T.useEffect(()=>{r.length>0&&Object.keys(e).length===0&&f()},[r.length]),a)return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:Array.from({length:4}).map((o,c)=>t.jsx(F,{className:"h-20 rounded-xl"},c))}),t.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((o,c)=>t.jsx(Ue,{},c))})]});if(s)return t.jsxs($,{className:"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-950/30",children:[t.jsxs(I,{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ee,{className:"size-5 text-red-500"}),t.jsx(G,{className:"text-red-700 dark:text-red-400",children:"Connection Error"})]}),t.jsx(J,{className:"text-red-600/80 dark:text-red-400/80",children:s})]}),t.jsx(H,{children:t.jsxs(U,{variant:"destructive",size:"sm",onClick:()=>i(),children:[t.jsx(B,{className:"size-4"}),"Try Again"]})})]});const m=[...r].sort((o,c)=>o.type==="Hub"&&c.type!=="Hub"?1:o.type!=="Hub"&&c.type==="Hub"?-1:(o.name??"").localeCompare(c.name??"")),x=m.filter(o=>o.type!=="Hub"),u=m.filter(o=>o.type==="Hub");return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Sensor Dashboard"}),l&&t.jsxs("p",{className:"mt-0.5 text-sm text-muted-foreground",children:["Last synced ",le(l)]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(U,{variant:"default",onClick:()=>f(),children:[t.jsx(Z,{className:"size-4"}),"Refresh All"]}),t.jsxs(U,{variant:"outline",onClick:()=>i(),children:[t.jsx(B,{className:"size-4"}),"Reload Devices"]})]})]}),t.jsx(Oe,{devices:r,deviceStates:e}),r.length===0&&t.jsx($,{children:t.jsxs(H,{className:"flex flex-col items-center gap-3 py-12 text-center",children:[t.jsx(K,{className:"size-12 text-muted-foreground/30"}),t.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"No devices found"}),t.jsx("p",{className:"text-sm text-muted-foreground/70",children:"Make sure your YoSmart Hub is connected and devices are paired."})]})}),x.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"mb-3 text-sm font-medium uppercase tracking-wider text-muted-foreground",children:["Sensors (",x.length,")"]}),t.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:x.map(o=>t.jsx(re,{device:o,status:p(o.deviceId),onRefresh:()=>d(o.deviceId,o.token,o.type)},o.deviceId))})]}),u.length>0&&t.jsxs("div",{children:[t.jsx("h3",{className:"mb-3 text-sm font-medium uppercase tracking-wider text-muted-foreground",children:"Hub"}),t.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:u.map(o=>t.jsx(re,{device:o,status:p(o.deviceId),onRefresh:()=>d(o.deviceId,o.token,o.type)},o.deviceId))})]})]})}const Xe=[{title:"Dashboard",href:ce().url}];function lt(){const r=C.c(2);let e;r[0]===Symbol.for("react.memo_cache_sentinel")?(e=t.jsx(ne,{title:"Dashboard"}),r[0]=e):e=r[0];let a;return r[1]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsxs(oe,{breadcrumbs:Xe,children:[e,t.jsx("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-auto rounded-xl p-4 md:p-6",children:t.jsx(We,{})})]}),r[1]=a):a=r[1],a}export{lt as default};
